# 行程总览页面修复说明

## 问题描述

北京攻略的"行程总览·时间轴+地图双视图"页面可能存在以下问题:

1. **时间轴数据为空** - 没有显示每日行程
2. **地图标记点缺失** - 北京景点坐标不完整
3. **解析失败** - Markdown表格解析不正确

## 已修复内容

### 1. 改进了行程解析函数

**改进点**:
- ✅ 更宽松的正则表达式匹配
- ✅ 支持提取日期信息
- ✅ 改进表格行解析逻辑
- ✅ 更准确的类型判断(景点/餐饮/交通/酒店)
- ✅ 提取提示信息
- ✅ 添加默认数据兜底

**修改文件**: `src/pages/itinerary/[city].tsx`

### 2. 解析逻辑改进

#### 原来的问题:
```typescript
// 简单的正则,可能匹配不到
/###\s*Day\s*(\d+)[^#]*(.*?)(?=###\s*Day|\n##|$)/gs
```

#### 现在的改进:
```typescript
// 更宽松的匹配,支持多行
/###\s*Day\s*(\d+)[^#\n]*\n+(.*?)(?=###\s*Day|##\s|$)/gis
```

### 3. 表格解析改进

**支持的格式**:
```markdown
| 时间 | 行程 | 贴士 |
|------|------|------|
| 05:30 | 天安门广场看升旗 | 从天安门西红墙安检01口进 |
```

**提取内容**:
- ✅ 时间
- ✅ 活动内容
- ✅ 提示信息
- ✅ 自动判断类型(景点/餐饮/交通/酒店)

## 测试步骤

### 1. 刷新页面

访问: http://localhost:3000/itinerary/beijing

### 2. 检查内容

**时间轴部分**:
- [ ] Day 1-5 卡片是否显示
- [ ] 每天的主题是否正确
- [ ] 时间点是否显示
- [ ] 图标是否正确(🏛️景点/🍜餐饮/🚕交通/🏨酒店)
- [ ] 提示标签是否显示

**地图部分**:
- [ ] 地图是否加载
- [ ] 景点标记是否显示
- [ ] 路线是否绘制
- [ ] 点击标记是否有信息窗体

### 3. 交互测试

- [ ] 点击时间轴项目,地图是否滚动
- [ ] 点击地图标记,时间轴是否滚动
- [ ] 移动端布局是否正常

## 如果还有问题

### 问题1: 时间轴仍然为空

**原因**: Markdown格式不匹配

**解决方案**:
1. 检查`guides/beijing/春节5日游攻略.md`文件
2. 确保标题格式为: `### Day 1（日期）：主题`
3. 确保表格格式正确

**临时方案**: 代码已添加默认数据兜底,至少会显示"暂无详细行程数据"

### 问题2: 地图没有标记点

**原因**: 北京景点坐标数据不完整

**解决方案**:
打开 `src/data/locations.json`,补充更多北京景点:

```json
{
  "beijing": {
    "故宫": { "lat": 39.9163, "lng": 116.3972, "type": "attraction" },
    "天坛": { "lat": 39.8828, "lng": 116.4068, "type": "attraction" },
    "颐和园": { "lat": 40.0005, "lng": 116.2753, "type": "attraction" },
    "八达岭长城": { "lat": 40.3593, "lng": 116.0153, "type": "attraction" },
    "鸟巢": { "lat": 39.9928, "lng": 116.3903, "type": "attraction" },
    "水立方": { "lat": 39.9930, "lng": 116.3886, "type": "attraction" },
    "圆明园": { "lat": 40.0076, "lng": 116.2955, "type": "attraction" },
    "景山公园": { "lat": 39.9254, "lng": 116.3944, "type": "attraction" },
    "天安门": { "lat": 39.9075, "lng": 116.3972, "type": "attraction" },
    "庆丰包子铺": { "lat": 39.9141, "lng": 116.4074, "type": "restaurant" },
    "四季民福烤鸭店": { "lat": 39.9180, "lng": 116.3950, "type": "restaurant" }
  }
}
```

### 问题3: 页面加载很慢

**原因**: 地图API加载或数据量大

**解决方案**:
- 检查网络连接
- 检查高德地图Key是否有效
- 查看浏览器控制台是否有错误

## 预期效果

修复后,页面应该显示:

**时间轴**:
```
Day 1 - 中轴线经典游
├─ 05:30 🏛️ 天安门广场看升旗
│  💡 从天安门西红墙安检01口进,排队少
├─ 07:00 🍜 在附近吃早餐
│  💡 推荐庆丰包子铺
├─ 08:30 🏛️ 故宫游览
│  💡 从东华门进最快,珍宝馆+钟表馆必看
└─ ...
```

**地图**:
- 显示北京地图
- 标记所有景点位置
- 用蓝色线连接路线
- 点击标记显示景点信息

## 进一步优化建议

1. **添加更多景点坐标** - 完善locations.json
2. **改进Markdown格式** - 统一攻略文件格式
3. **添加加载状态** - 显示"正在加载行程数据..."
4. **错误处理** - 解析失败时友好提示
5. **性能优化** - 大数据量时分页显示

## 联系方式

如果问题仍然存在,请:
1. 截图页面显示的内容
2. 打开浏览器开发者工具(F12)查看Console错误
3. 检查Network标签是否有请求失败
